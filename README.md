# TOTP Generator
This project implements [RFC 2104](https://datatracker.ietf.org/doc/html/rfc2104), [RFC 4226](https://datatracker.ietf.org/doc/html/rfc4226) and [RFC 6238](https://datatracker.ietf.org/doc/html/RFC6238) in order to generate Time-based One-Time Passwords (TOTP).

Time-based One-Time Passwords are used in multi-factor authentication, and are usually generated using a mobile application such as Google Authenticator.
They consist of 6 digit numeric codes, which change every 30 seconds.
The number of digits and length of time that the codes last can vary, but 6 digits and 30 seconds are the most common parameters. 

## How TOTP codes work
TOTPs are generated using hash-based message authentication codes, which use a shared secret and a counter value. 
In the case of HOTP (HMAC-based One-Time Passwords), the counter is event based, and increments by one each time a new code is required.
In the case of TOTP (Time-based One-Time Passwords), the counter value is the number of 30 second time periods since the Unix epoch.
The relevant hash is then processed using a function known as "Trunctate" to produce an apparently random numeric code that is valid for authentication for a limited time period.

## Hashing algorithms
TOTP codes are usually generated using SHA-1, but they can use other hashing algorithms such as SHA-256 or SHA-512. 
This implementation currently always uses SHA-1, but could be adapted in the future to use SHA-256 or SHA-512.

## How to use
In order to generate TOTP codes, a shared secret between the client and server is required. This is usually transferred via a QR code provided by the service when 2FA is setup. 

In order to generate codes using this program, the secret key should be extracted from the QR code using any QR code scanner.
The secret is stored in [Key URI format](https://github.com/google/google-authenticator/wiki/Key-Uri-Format).
To generate codes, the secrets should be placed in ```keys.txt``` with one secret per line.
When executed, the Python script will read the secrets in from the ```keys.txt``` file, and will output the TOTP code for each secret.
The program defaults to generating codes that are currently valid, but custom times can be chosen using the ```-t``` argument.
The time should be provided in Unix time (The number of seconds that have elapsed since 00:00:00 UTC on 1st January 1970).

### Example
The expected results from RFC 6238 can be replicated by adding the following line to ```keys.txt```.
```
otpauth://totp/Example:Example?issuer=Example&secret=GEZDGNBVGY3TQOJQGEZDGNBVGY3TQOJQ&algorithm=SHA1&digits=8&period=30
```
The secret here is the base 32 representation of the ASCII value "12345678901234567890" which is found in the RFC. 
With this key, the codes can be generated by running the program with the following command.
```
python3 totp.py -t TIME_VALUE
```

This should produce the following expected results.

| Time value (s) | Expected code |
| --- | --- |
| 59 | 94287082 |
| 1111111109 | 07081804 |
| 1111111111 | 14050471 |
| 1234567890 | 89005924 |
| 2000000000 | 69279037 |
| 20000000000 | 65353130 |

